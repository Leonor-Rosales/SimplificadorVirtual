{% extends "base.html" %}

{% block title %}Inicio - Simplificador Booleano{% endblock %}

{% block content %}
<h1 class="mb-4">Simplificador de Funciones Booleanas</h1>
<p class="lead">Construye tu función booleana usando los botones y observa cómo se simplifica paso a paso.</p>

<div class="card shadow-sm position-relative">

  <button type="button" class="btn btn-success position-absolute top-0 end-0 m-2"
          style="background-color: #76c776; border-color: #76c776;"
          onclick="window.location.href='{{ url_for('routes.variables') }}'">
    + Más Variables
  </button>

  <div class="card-body pt-5">


    <div class="mb-2">
      <input type="text" id="entrada" class="form-control form-control-lg"
             placeholder="Construye tu expresión" value="{{ funcion_original }}" readonly>
      {% if error %}
        <div class="text-danger mt-1"><strong>{{ error }}</strong></div>
      {% endif %}
    </div>


    <div class="d-flex justify-content-between align-items-start">
      <div class="flex-column me-3">
        <div class="mb-2">
          <button type="button" class="btn btn-outline-primary btn-lg" onclick="agregar('A')">A</button>
          <button type="button" class="btn btn-outline-primary btn-lg" onclick="agregar('B')">B</button>
          <button type="button" class="btn btn-outline-primary btn-lg" onclick="agregar('C')">C</button>
          <button type="button" class="btn btn-outline-primary btn-lg" onclick="agregar('D')">D</button>
          <button type="button" class="btn btn-outline-primary btn-lg" onclick="agregar('E')">E</button>
        </div>

        <div class="mb-2">
          <button type="button" class="btn btn-outline-secondary btn-lg" onclick="agregar('1')">1</button>
          <button type="button" class="btn btn-outline-secondary btn-lg" onclick="agregar('0')">0</button>
        </div>

        <div class="mb-2">
          <button type="button" class="btn btn-outline-warning btn-lg" onclick="agregar('+')">+</button>
          <button type="button" class="btn btn-outline-warning btn-lg" onclick="agregar('*')">*</button>
          <button type="button" class="btn btn-outline-warning btn-lg" onclick="agregar('~')">~</button>
          <button type="button" class="btn btn-outline-warning btn-lg" onclick="agregar('(')">(</button>
          <button type="button" class="btn btn-outline-warning btn-lg" onclick="agregar(')')">)</button>
        </div>
      </div>

      <div class="d-flex flex-column justify-content-center ms-auto">
        <button type="button" class="btn btn-danger btn-lg mb-2" onclick="borrar()">⌫ Eliminar</button>
        <button type="button" class="btn btn-danger btn-lg" onclick="limpiar()">Limpiar</button>
      </div>

    </div>

    <form method="POST" class="mt-3" onsubmit="actualizarExpresion()">
      <input type="hidden" id="hidden-expresion" name="expresion">
      <button type="submit" class="btn btn-primary btn-lg w-100">Simplificar</button>
    </form>

    {% if funcion_original %}
      <hr>
      <div class="alert alert-info">
        <strong>Función ingresada:</strong> <code>{{ funcion_original }}</code>
      </div>
    {% endif %}

    {% if pasos_detallados %}
      <h5 class="mt-3">Pasos de simplificación:</h5>
      <ol class="list-group list-group-numbered">
        {% for p in pasos_detallados %}
          <li class="list-group-item">
            Paso {{ loop.index }}: {{ p.antes }} → {{ p.despues }} ({{ p.ley }})
          </li>
        {% endfor %}
      </ol>
    {% endif %}

    {% if resultado %}
      <hr>
      <h4>Respuesta final:</h4>
      <div class="alert alert-success fs-5"><strong>{{ resultado }}</strong></div>

      <form method="POST" action="{{ url_for('routes.guardar') }}">
        <input type="hidden" name="pasos" value="{{ pasos_txt }}">
        <button type="submit" class="btn btn-success mt-2">Guardar resultado</button>
      </form>
    {% endif %}

  </div>
</div>

{% if historial %}
<div class="mb-3">
  <label for="historial" class="form-label">Historial de expresiones:</label>
  <select id="historial" class="form-select" onchange="cargarHistorial()">
    <option value="">-- Selecciona una expresión --</option>
    {% for h in historial %}
      <option value="{{ h }}">{{ h }}</option>
    {% endfor %}
  </select>
</div>
{% endif %}

<script>
function agregar(valor) {
    const input = document.getElementById('entrada');
    const start = input.selectionStart;
    const end = input.selectionEnd;
    input.value = input.value.slice(0, start) + valor + input.value.slice(end);
    input.setSelectionRange(start + valor.length, start + valor.length);
    input.focus();
}

function borrar() {
    const input = document.getElementById('entrada');
    const start = input.selectionStart;
    const end = input.selectionEnd;
    if (start === end && start > 0) {
        input.value = input.value.slice(0, start - 1) + input.value.slice(end);
        input.setSelectionRange(start - 1, start - 1);
    } else {
        input.value = input.value.slice(0, start) + input.value.slice(end);
        input.setSelectionRange(start, start);
    }
    input.focus();
}

function limpiar() {
    const input = document.getElementById('entrada');
    input.value = '';
    input.focus();
}

function actualizarExpresion() {
    document.getElementById('hidden-expresion').value = document.getElementById('entrada').value;
}
</script>
{% endblock %}
